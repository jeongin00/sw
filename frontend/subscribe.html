<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >
    <meta name="author" content="GREEN POWER" />
    <meta name="description" content="다양한 친환경 제품을 만나보세요. 환경을 지키는 소비! GREEN STORE!" />
    <title>GREEN STORE - 구독상품 관리</title>
    <link rel="stylesheet" href="css/style_subscribe.css"> <!-- 필요한 경우 경로 수정 -->

 <!-- Font Awesome 라이브러리 추가 -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

 <!-- Favicon 설정 -->
 <link rel="icon" href="img/favicon-48x48.ico" type="image/x-icon">

 <!-- Google Web Fonts -->
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Inter:wght@700;800&display=swap" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

 <!-- Icon Font Stylesheet -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

 <!-- Libraries Stylesheet -->
 <link href="lib/animate/animate.min.css" rel="stylesheet">
 <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

 <!-- Customized Bootstrap Stylesheet -->
 <link href="css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
 <header>
     <div class="header-left">
         <i class="fas fa-chevron-down icon"></i> <!-- 아래로 향하는 아이콘 추가 -->
         <button>입점 신청</button>
     </div>
     <div class="header-right">
        <a href="/public/adduser.html"><button>회원가입</button></a>
        <a href="/public/login.html"><button>로그인</button></a>
         <a href="/frontend/cart.html"><button>장바구니</button></a>
         <button>주문배송</button>
         <a href="#" onclick="checkLogin()"><button>마이페이지</button></a>
     </div>
 </header>
 <br><br>
<div class="logo-search">
 <img src="img/favicon-48x48.ico" alt="Favicon" class="favicon">
 <a class="homepage-logo-link" href="index.html"><div class="logo">GREEN STORE</div> </a>
 <!-- 검색창과 돋보기 버튼을 포함하는 div 추가 -->
 <div class="search-container">
     <input type="text" placeholder="상품, 브랜드 검색" class="search-box" id="search-input">
     <button type="button" class="search-button">
         <i class="fas fa-search"></i> <!-- Font Awesome의 돋보기 아이콘 -->
     </button>
 </div>
 <div class="interest-store">
     <i class="far fa-star"></i>
     <button>관심매장 소식</button>
 </div>
</div>

 <hr class="category-divider1"> <!-- 위쪽 가로줄 -->

 <nav class="thirdline">
    <nav class="main-menu">
        <i class="fas fa-bars menu-icon"></i> <!-- 메뉴 아이콘 -->
        <button class="category-button" id="category-toggle">카테고리</button>
        <ul class="category-menu" id="category-menu">
            <li><a href="/public/selfcare.html">셀프케어</a></li>
            <li><a href="/public/living.html">리빙</a></li>
            <li><a href="/public/pet.html">펫</a></li>
            <li><a href="/public/fassion.html">패션</a></li>
            <li><a href="/public/supplies.html">문구용품</a></li>
            <li><a href="/public/food.html">푸드</a></li>
            <li><a href="/public/agricultural.html">농산물</a></li>
            <li><a href="#">사회적거리</a></li>
            <li><a href="/public/kit.html">취미/키트</a></li>
            <li><a href="#">체험</a></li>
        </ul>
    </nav>
    <span class="first-main-button"></span>
    <button class="main-button">About Us</button>
    <a class="homepage-logo-link" href="subscribe.html"><button class="main-button">구독상품 관리</button></a>
    <a class="homepage-logo-link" href="/frontend/place.html"><button class="main-button">주변매장 찾기</button></a>
    <button class="main-button">자원 회수</button>
    <button class="main-button">멤버쉽/쿠폰</button>
    <button class="main-button">이벤트</button>
    <button class="main-button">지역 행사</button>
</nav>
<hr class="category-divider2">

    <!-- main Start -->
     <!-- 메인 섹션 -->
     <main>
        <!-- 카테고리 섹션 (좌측에 위치) -->
        <aside id="categories" style="flex: 1;">
            <h2 id="category-title">전체</h2>
            <div class="category-divider"></div> <!-- 카테고리 아래 회색 줄 -->
            <button onclick="filterProducts('전체')">전체</button>
            <button onclick="filterProducts('셀프케어')">셀프케어</button>
            <button onclick="filterProducts('리빙')">리빙</button>
            <button onclick="filterProducts('펫 용품')">펫 용품</button>
            <button onclick="filterProducts('패션')">패션</button>
            <button onclick="filterProducts('문구용품')">문구용품</button>
            <button onclick="filterProducts('푸드')">푸드</button>
            <button onclick="filterProducts('친환경 농산물')">친환경 농산물</button>
            <button onclick="filterProducts('취미/키트')">취미/키트</button>
        </aside>
        

        <!-- 콘텐츠 섹션 (우측에 위치) -->
        <section id="content">
            <!-- 구독 상품 관리 버튼과 목록 버튼 -->
            <div id="view-options">
                <button id="product-list-btn" onclick="showProductList()">구독 상품 목록</button>
                <button id="subscription-management-btn" onclick="handleSubscription()">구독 상품 관리</button>
            </div>
        <!-- 구독 상품 목록 섹션 -->
        <section id="product-list" style="display: block;">
            <!-- 상품 목록이 표시될 컨테이너 -->
            <div id="product-grid" class="product-grid">
                <!-- 상품 데이터는 JavaScript로 동적으로 추가됩니다. -->
            </div>
            <!-- 다른 구독 상품을 여기에 추가 -->
            <!-- 페이지네이션 컨트롤 -->
            <div id="pagination-controls" class="pagination-controls">
                <button onclick="prevPage()">&#60;</button> <!-- 이전 페이지 버튼 -->
                <span id="page-numbers"></span> <!-- 페이지 번호 표시 -->
                <button onclick="nextPage()">&#62;</button> <!-- 다음 페이지 버튼 -->
            </div>
        </section>

        <!-- 구독 상품 관리 섹션 (로그인 시만 표시) -->
        <section id="subscription-management" style="display: none;">
            <div id="subscription-header">
                <h2>구독 상품 관리</h2>
                <div class="management-divider"></div> <!-- 구독 관리 제목 아래 회색 줄 -->
            </div>
            <div id="subscription-list">
                <!-- 예시 구독 상품 -->
                <div class="subscription-item">
                    <img src="img/sample-product.jpg" alt="상품 이미지" class="product-image">
                    <p class="package-name">상쾌 치약 칫솔 세트</p>
                    <p class="delivery-date">2024-10-31 - 목요일</p>
                    <button class="action-button cancel-button">취소</button>
                    <button class="action-button change-date-button">변경</button>
                </div>
            </div>
        </section>
        <!-- 로그인 필요 메시지 -->
        <p id="login-message" style="display: none; color: rgba(0, 0, 0, 0.5); font-size: 1em; text-align: center;">
            구독이 필요해요! 로그인 후 이용해주세요.
        </p>
        <!-- 구독하지 않은 경우 메시지 및 구독하기 버튼 -->
        <div id="subscribe-message" style="display: none; text-align: center;">
            <p style="color: rgba(0, 0, 0, 0.5); font-size: 1em;">
                구독이 필요해요!<br>구독하고 할인된 가격으로 친환경 제품을 받아보세요!
            </p>
            <button onclick="subscribe()" class="subscribe-button">구독하기</button>
        </div>
    </main>
    <!-- main End -->
    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Get In Touch</h5>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i> 부산광역시 사하구 낙동대로 550번길 37 </p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>심유나, 황정인 </p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i> info@example.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Quick Links</h5>
                    <a class="btn btn-link text-white-50" href="">1:1 문의</a>
                    <a class="btn btn-link text-white-50" href="">자주하는 질문</a>
                    <a class="btn btn-link text-white-50" href="">공지사항</a>
                    <a class="btn btn-link text-white-50" href="">이용약관</a>
                    <a class="btn btn-link text-white-50" href="">개인정보처리방침</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Newsletter</h5>
                    <p class="newsletter-text">뉴스레터를 구독하면 다양한 소식을 받을 수 있어요.</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input class="form-control bg-transparent w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">신청</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">GREEN STORE</a>, All Right Reserved. 
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->
</body>


<!--==========JavaScript start!========== -->
<!-- header JavaScript -->
<script>
    // 검색 버튼 클릭 이벤트 추가
    document.getElementById('search-btn').addEventListener('click', function() {
        // 입력된 검색어 가져오기
        var query = document.getElementById('search-input').value;
        
        // 검색어가 입력되었는지 확인
        if (query) {
            // 검색어가 있으면 alert로 검색어를 출력 (기본 동작 테스트)
            alert('검색어: ' + query + ' 로 검색합니다.');
            
            // 여기에 검색 기능을 처리할 코드를 추가할 수 있습니다.
            // 예를 들어, 서버로 검색어를 전송하여 검색 결과를 가져오는 작업을 할 수 있습니다.
            performSearch(query);  // 검색 함수 호출
        } else {
            // 검색어가 없으면 경고 메시지 표시
            alert('검색어를 입력해주세요.');
        }
    });

</script>
<script>
    function displaySearchResults(results) {
    var resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = ''; // 이전 검색 결과 초기화

    if (results.length === 0) {
        resultsContainer.innerHTML = '<p>검색 결과가 없습니다.</p>';
        return;
    }

    results.forEach(function(result) {
        var resultItem = document.createElement('div');
        resultItem.classList.add('result-item');
        resultItem.innerHTML = `
            <h3>${result.productName}</h3>
            <p>브랜드: ${result.brand}</p>
            <p>가격: ${result.price}</p>
        `;
        resultsContainer.appendChild(resultItem);
    });
}
</script>

<!-- body JavaScript -->
<script>
    // 탭 메뉴 항목 클릭 시 active 클래스 추가
    const tabs = document.querySelectorAll('.tab-item a');
    tabs.forEach(tab => {
        tab.addEventListener('click', function (event) {
            tabs.forEach(t => t.classList.remove('active')); // 모든 탭의 active 클래스 제거
            this.classList.add('active'); // 클릭된 탭에 active 클래스 추가
        });
    });
</script>

<!-- body-main JavaScript -->
<script>
    document.getElementById('category-toggle').addEventListener('click', function() {
        var categoryMenu = document.getElementById('category-menu');
        if (categoryMenu.style.display === 'none' || categoryMenu.style.display === '') {
            categoryMenu.style.display = 'block';
        } else {
            categoryMenu.style.display = 'none';
        }
    });
</script>

<script>
    // 로그인 여부를 확인하는 변수
    const isLoggedIn = false; // 실제 로그인 여부는 서버와 연동하여 설정

    // 초기 페이지 로드 시 로컬 스토리지 상태 확인
    document.addEventListener("DOMContentLoaded", function () {
        const activeButton = localStorage.getItem("activeButton");
        if (activeButton === "product-list") {
            showProductList();
        } else {
            handleSubscription();
        }
    });

    // 초기 페이지 설정
    document.addEventListener("DOMContentLoaded", function () {
        showProductList(); // 초기에는 구독 상품 목록을 표시
    });

    // "구독 상품 목록"을 기본으로 표시
    function showProductList() {
        document.getElementById("product-list").style.display = "block";
        document.getElementById("subscription-management").style.display = "none";
        document.getElementById("login-message").style.display = "none";

        // 버튼 색상 변경 및 로컬 스토리지에 저장
        document.getElementById("product-list-btn").classList.add("active-button");
        document.getElementById("subscription-management-btn").classList.remove("active-button");
        localStorage.setItem("activeButton", "product-list");
    }   

    // 카테고리 필터 및 제목 업데이트
    function filterProducts(category) {
        document.getElementById('category-title').textContent = category;

        // 서버로부터 선택한 카테고리의 상품을 가져옴
        fetch(`http://localhost:3000/products?category=${encodeURIComponent(category)}`)
            .then(response => response.json())
            .then(data => {
                const productGrid = document.getElementById("product-grid");
                productGrid.innerHTML = ''; // 기존 내용을 비움

                // 가져온 데이터를 HTML로 렌더링
                data.forEach(product => {
                    const productDiv = document.createElement("div");
                    productDiv.classList.add("product-card");

                    productDiv.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="product-image">
                        <p class="product-brand">${product.brand}</p>
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-description">${product.description}</p>
                        <p class="product-carbon">${product.carbon.toFixed(2)} Kg CO2e</p>
                    `;

                    productGrid.appendChild(productDiv);
                });
            })
            .catch(error => {
                console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
            });
    }

    // 페이지 로드시 기본 카테고리 데이터 불러오기
    document.addEventListener("DOMContentLoaded", function () {
        filterProducts('전체'); // 페이지 로드 시 전체 상품을 표시
    });

// HTML에서 API 호출 코드 추가 @@@@@@@@@@@@
function loadProductData() {
    fetch('http://localhost:3000/products')
        .then(response => response.json())
        .then(data => {
            const productGrid = document.getElementById("product-grid");
            productGrid.innerHTML = ''; // 기존 내용을 비움

            // 데이터를 HTML로 렌더링
            data.forEach(product => {
                const productDiv = document.createElement("div");
                productDiv.classList.add("product");

                productDiv.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>브랜드: ${product.brand}</p>
                    <p>카테고리: ${product.category}</p>
                    <p>탄소 배출량 감소: ${product.carbon}</p>
                `;
                
                productGrid.appendChild(productDiv);
            });
        })
        .catch(error => {
            console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
        });
}



    // 구독 관리 버튼 클릭 시 로그인 여부 확인 후 페이지 변경
    function handleSubscription() {
        document.getElementById("product-list").style.display = "none";

        if (isLoggedIn) {
            document.getElementById("subscription-management").style.display = "block";
            document.getElementById("login-message").style.display = "none";
        } else {
            document.getElementById("subscription-management").style.display = "none";
            document.getElementById("login-message").style.display = "block";
        }

        // 버튼 색상 변경 및 로컬 스토리지에 저장
        document.getElementById("subscription-management-btn").classList.add("active-button");
        document.getElementById("product-list-btn").classList.remove("active-button");
        localStorage.setItem("activeButton", "subscription-management");
    }
    </script>
    <script>
    // 상품 데이터를 가져와서 상품 카드로 표시하는 부분
    function filterProducts(category) {
        document.getElementById('category-title').textContent = category;

        // 서버로부터 선택한 카테고리의 상품을 가져옴
        fetch(`http://localhost:3000/products?category=${encodeURIComponent(category)}`)
            .then(response => response.json())
            .then(data => {
                const productGrid = document.getElementById("product-grid");
                productGrid.innerHTML = ''; // 기존 내용을 비움

                // 가져온 데이터를 HTML로 렌더링
                data.forEach(product => {
                    const productDiv = document.createElement("div");
                    productDiv.classList.add("product-card");

                    // 상품 클릭 시 패키지 상세 페이지로 이동하도록 링크 추가
                    productDiv.innerHTML = `
                        <a href="/frontend/packagedetail.html?id=${product.id}">
                            <img src="${product.image}" alt="${product.name}" class="product-image">
                            <p class="product-brand">${product.brand}</p>
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <p class="product-carbon">${product.carbon.toFixed(2)} Kg CO2e</p>
                        </a>
                    `;

                    productGrid.appendChild(productDiv);
                });
            })
            .catch(error => {
                console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
            });
    }
    </script>


</body>
</html>