<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >
    <meta name="author" content="GREEN POWER" />
    <meta name="description" content="다양한 친환경 제품을 만나보세요. 환경을 지키는 소비! GREEN STORE!" />
    <title>GREEN STORE - 구독상품 관리</title>
    <link rel="stylesheet" href="css/style_place.css"> <!-- 필요한 경우 경로 수정 -->
      <!-- Leaflet CSS -->
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
 <!-- Font Awesome 라이브러리 추가 -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

 <!-- Favicon 설정 -->
 <link rel="icon" href="img/favicon-48x48.ico" type="image/x-icon">

 <!-- Google Web Fonts -->
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Inter:wght@700;800&display=swap" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

 <!-- Icon Font Stylesheet -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

 <!-- Libraries Stylesheet -->
 <link href="lib/animate/animate.min.css" rel="stylesheet">
 <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

 <!-- Customized Bootstrap Stylesheet -->
 <link href="css/bootstrap.min.css" rel="stylesheet">


</head>
</head>
<body>
 <header>
     <div class="header-left">
         <i class="fas fa-chevron-down icon"></i> <!-- 아래로 향하는 아이콘 추가 -->
         <button>입점 신청</button>
     </div>
     <div class="header-right">
        <a href="/public/adduser.html"><button>회원가입</button></a>
        <a href="/public/login.html"><button>로그인</button></a>
        <a href="/public/cart.html"><button>장바구니</button></a>
        <button>주문배송</button>
    </div>
 </header>
 <br><br>
<div class="logo-search">
 <img src="img/favicon-48x48.ico" alt="Favicon" class="favicon">
 <a class="homepage-logo-link" href="index.html"><div class="logo">GREEN STORE</div> </a>
 <!-- 검색창과 돋보기 버튼을 포함하는 div 추가 -->
 <div class="search-container">
     <input type="text" placeholder="상품, 브랜드 검색" class="search-box" id="search-input">
     <button type="button" class="search-button">
         <i class="fas fa-search"></i> <!-- Font Awesome의 돋보기 아이콘 -->
     </button>
 </div>
 <div class="interest-store">
     <i class="far fa-star"></i>
     <button>관심매장 소식</button>
 </div>
</div>

 <hr class="category-divider1"> <!-- 위쪽 가로줄 -->

 <nav class="thirdline">
    <nav class="main-menu">
        <i class="fas fa-bars menu-icon"></i> <!-- 메뉴 아이콘 -->
        <button class="category-button" id="category-toggle">카테고리</button>
        <ul class="category-menu" id="category-menu">
            <li><a href="/public/selfcare.html">셀프케어</a></li>
            <li><a href="/public/living.html">리빙</a></li>
            <li><a href="/public/pet.html">펫 용품</a></li>
            <li><a href="/public/fassion.html">패션</a></li>
            <li><a href="/public/supplies.html">문구용품</a></li>
            <li><a href="/public/food.html">푸드</a></li>
            <li><a href="/public/agricultural.html">친환경 농산물</a></li>
            <li><a href="/public/kit.html">취미/키트</a></li>
            <li><a href="#">체험</a></li>
        </ul>
    </nav>
    <span class="first-main-button"></span>
    <a class="homepage-logo-link" href="/frontend/aboutus.html"><button class="main-button">About Us</button></a>
    <a class="homepage-logo-link" href="/frontend/subscribe.html"><button class="main-button">구독상품 관리</button></a>
    <a class="homepage-logo-link" href="/frontend/place.html"><button class="main-button">주변매장 찾기</button></a>
    <button class="main-button">자원 회수</button>
    <button class="main-button">멤버쉽/쿠폰</button>
    <button class="main-button">이벤트</button>
    <a class="homepage-logo-link" href="/public/local.html"><button class="main-button">지역 행사</button></a>
</nav>
<hr class="category-divider2">

<!-- main Start -->
<main>
    <div class="location-title">
        <h1>주변 매장 찾기</h1>
        <p>주변에 있는 녹색 매장과 제로웨이스트샵을 찾아서 직접 방문해보세요!</p>
    </div>
    
    <!-- 지역 선택과 검색 버튼 -->
    <div class="location-selector">
        <select id="province" onchange="populateCity()">
            <option value="">지역(도) 선택</option>
            <option value="서울특별시">서울특별시</option>
            <option value="부산광역시">부산광역시</option>
            <option value="대구광역시">대구광역시</option>
            <option value="인천광역시">인천광역시</option>
            <option value="광주광역시">광주광역시</option>
            <option value="대전광역시">대전광역시</option>
            <option value="울산광역시">울산광역시</option>
            <option value="세종특별자치시">세종특별자치시</option>
            <option value="경기도">경기도</option>
            <option value="강원도">강원도</option>
            <option value="충청북도">충청북도</option>
            <option value="충청남도">충청남도</option>
            <option value="전라북도">전라북도</option>
            <option value="전라남도">전라남도</option>
            <option value="경상북도">경상북도</option>
            <option value="경상남도">경상남도</option>
            <option value="제주특별자치도">제주특별자치도</option>
        </select>
        &nbsp;&nbsp;&nbsp;
        <select id="city">
            <option value="">시/군/구 선택</option>
        </select>

        <button onclick="searchStores()">검색</button>
    </div>

    <!-- 지도 영역 -->
    <div id="map"></div>

    <!-- 매장 목록 UI -->
    <div id="store-list" class="store-list">
       <!-- 매장 정보가 동적으로 추가됩니다 -->
    </div>

    <!-- Pagination controls -->
    <div class="pagination">
        <button onclick="prevPage()">이전</button>
        <span id="page-info">1 / 5</span>
        <button onclick="nextPage()">다음</button>
    </div>
</main>
<!-- main End -->


<!-- Footer Start -->
    <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Get In Touch</h5>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i> 부산광역시 사하구 낙동대로 550번길 37 </p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>심유나, 황정인 </p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i> info@example.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Quick Links</h5>
                    <a class="btn btn-link text-white-50" href="">1:1 문의</a>
                    <a class="btn btn-link text-white-50" href="">자주하는 질문</a>
                    <a class="btn btn-link text-white-50" href="">공지사항</a>
                    <a class="btn btn-link text-white-50" href="">이용약관</a>
                    <a class="btn btn-link text-white-50" href="">개인정보처리방침</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Newsletter</h5>
                    <p class="newsletter-text">뉴스레터를 구독하면 다양한 소식을 받을 수 있어요.</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input class="form-control bg-transparent w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">신청</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">GREEN STORE</a>, All Right Reserved. 
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->
</body>

<!--==========JavaScript start!========== -->
<!-- header JavaScript -->
<script>
    // 검색 버튼 클릭 이벤트 추가
    document.getElementById('search-btn').addEventListener('click', function() {
        // 입력된 검색어 가져오기
        var query = document.getElementById('search-input').value;
        
        // 검색어가 입력되었는지 확인
        if (query) {
            // 검색어가 있으면 alert로 검색어를 출력 (기본 동작 테스트)
            alert('검색어: ' + query + ' 로 검색합니다.');
            
            // 여기에 검색 기능을 처리할 코드를 추가할 수 있습니다.
            // 예를 들어, 서버로 검색어를 전송하여 검색 결과를 가져오는 작업을 할 수 있습니다.
            performSearch(query);  // 검색 함수 호출
        } else {
            // 검색어가 없으면 경고 메시지 표시
            alert('검색어를 입력해주세요.');
        }
    });

</script>
<script>
    function displaySearchResults(results) {
    var resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = ''; // 이전 검색 결과 초기화

    if (results.length === 0) {
        resultsContainer.innerHTML = '<p>검색 결과가 없습니다.</p>';
        return;
    }

    results.forEach(function(result) {
        var resultItem = document.createElement('div');
        resultItem.classList.add('result-item');
        resultItem.innerHTML = `
            <h3>${result.productName}</h3>
            <p>브랜드: ${result.brand}</p>
            <p>가격: ${result.price}</p>
        `;
        resultsContainer.appendChild(resultItem);
    });
}
</script>
<script>
    const regionData = {
        "서울특별시": ["종로구", "중구", "용산구", "성동구", "광진구", "동대문구", "중랑구", "성북구", "강북구", "도봉구", "노원구", "은평구", "서대문구", "마포구", "양천구", "강서구", "구로구", "금천구", "영등포구", "동작구", "관악구", "서초구", "강남구", "송파구", "강동구"],
        "부산광역시": ["중구", "서구", "동구", "영도구", "부산진구", "동래구", "남구", "북구", "해운대구", "사하구", "금정구", "강서구", "연제구", "수영구", "사상구", "기장군"],
        "서울특별시": ["종로구", "중구", "용산구", "성동구", "광진구", "동대문구", "중랑구", "성북구", "강북구", "도봉구", "노원구", "은평구", "서대문구", "마포구", "양천구", "강서구", "구로구", "금천구", "영등포구", "동작구", "관악구", "서초구", "강남구", "송파구", "강동구"],
        "부산광역시": ["중구", "서구", "동구", "영도구", "부산진구", "동래구", "남구", "북구", "해운대구", "사하구", "금정구", "강서구", "연제구", "수영구", "사상구", "기장군"],
        "대구광역시": ["중구", "동구", "서구", "남구", "북구", "수성구", "달서구", "달성군"],
        "인천광역시": ["중구", "동구", "미추홀구", "연수구", "남동구", "부평구", "계양구", "서구", "강화군", "옹진군"],
        "광주광역시": ["동구", "서구", "남구", "북구", "광산구"],
        "대전광역시": ["동구", "중구", "서구", "유성구", "대덕구"],
        "울산광역시": ["중구", "남구", "동구", "북구", "울주군"],
        "세종특별자치시": ["세종특별자치시"],
        "경기도": ["수원시", "고양시", "용인시", "성남시", "부천시", "안산시", "남양주시", "화성시", "평택시", "의정부시", "시흥시", "파주시", "김포시", "광명시", "광주시", "군포시", "오산시", "이천시", "안성시", "의왕시", "하남시", "양주시", "구리시", "안양시", "과천시", "여주시", "동두천시", "가평군", "양평군", "연천군"],
        "강원도": ["춘천시", "원주시", "강릉시", "동해시", "태백시", "속초시", "삼척시", "홍천군", "횡성군", "영월군", "평창군", "정선군", "철원군", "화천군", "양구군", "인제군", "고성군", "양양군"],
        "충청북도": ["청주시", "충주시", "제천시", "보은군", "옥천군", "영동군", "증평군", "진천군", "괴산군", "음성군", "단양군"],
        "충청남도": ["천안시", "공주시", "보령시", "아산시", "서산시", "논산시", "계룡시", "당진시", "금산군", "부여군", "서천군", "청양군", "홍성군", "예산군", "태안군"],
        "전라북도": ["전주시", "군산시", "익산시", "정읍시", "남원시", "김제시", "완주군", "진안군", "무주군", "장수군", "임실군", "순창군", "고창군", "부안군"],
        "전라남도": ["목포시", "여수시", "순천시", "나주시", "광양시", "담양군", "곡성군", "구례군", "고흥군", "보성군", "화순군", "장흥군", "강진군", "해남군", "영암군", "무안군", "함평군", "영광군", "장성군", "완도군", "진도군", "신안군"],
        "경상북도": ["포항시", "경주시", "김천시", "안동시", "구미시", "영주시", "영천시", "상주시", "문경시", "경산시", "군위군", "의성군", "청송군", "영양군", "영덕군", "청도군", "고령군", "성주군", "칠곡군", "예천군", "봉화군", "울진군", "울릉군"],
        "경상남도": ["창원시", "진주시", "통영시", "사천시", "김해시", "밀양시", "거제시", "양산시", "의령군", "함안군", "창녕군", "고성군", "남해군", "하동군", "산청군", "함양군", "거창군", "합천군"],
        "제주특별자치도": ["제주시", "서귀포시"]
    };
    // 페이지 및 매장 데이터를 위한 초기 변수 설정
    let currentPage = 1;
    const itemsPerPage = 6; // 페이지당 표시할 항목 수
    let stores = []; // 전체 매장 데이터를 저장할 배열
    
    // 시/군/구 선택 박스에 해당 지역 데이터를 추가
    function populateCity() {
        const provinceSelect = document.getElementById('province');
        const citySelect = document.getElementById('city');
        const selectedProvince = provinceSelect.value;
    
        citySelect.innerHTML = '<option value="">시/군/구 선택</option>'; // 초기화
    
        if (regionData[selectedProvince]) {
            regionData[selectedProvince].forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });
        }
    }
    
    // 페이지 로드 시 전체 매장 데이터를 불러옴
    document.addEventListener('DOMContentLoaded', loadStores);
    
  
    // 모든 매장을 가져오는 함수
    async function loadStores() {
        try {
            const response = await fetch('/api/stores'); // 전체 매장 데이터를 요청
            stores = await response.json();
            currentPage = 1; // 첫 페이지로 초기화
            displayPage(currentPage); // 첫 페이지에 매장 목록 표시
            updatePageInfo(); // 페이지 정보 업데이트
        } catch (error) {
            console.error('모든 매장 정보를 불러오는 중 오류 발생:', error);
        }
    }
    
    // 검색 버튼 클릭 시 호출되는 함수
    async function searchStores() {
        const province = document.getElementById('province').value;
        const city = document.getElementById('city').value;
    
        if (!province || !city) {
            alert("지역과 시/군/구를 선택해 주세요.");
            return;
        }
    
        try {
            // 전체 매장 데이터 요청
            const response = await fetch('/api/stores');
            const allStores = await response.json();
    
            // province와 city로 필터링
            stores = allStores.filter(store => 
                store.province === province && store.city === city
            );
    
            // 필터링된 매장 데이터를 표시
            currentPage = 1; // 검색 결과 첫 페이지로 초기화
            displayPage(currentPage); // 첫 페이지에 검색 결과 표시
            updatePageInfo(); // 페이지 정보 업데이트
    
            console.log('검색 결과:', stores); // 결과 확인
        } catch (error) {
            console.error('매장 정보를 검색하는 중 오류 발생:', error);
        }
    }
    // 특정 페이지의 데이터를 화면에 표시하는 함수
    function displayPage(page) {
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const storeList = document.getElementById('store-list');
        storeList.innerHTML = ''; // 기존 매장 목록 초기화
    
        const pageItems = stores.slice(startIndex, endIndex);
        pageItems.forEach(store => {
            const storeItem = document.createElement('div');
            storeItem.classList.add('store-item');
    
            const imageUrl = store.image_url || 'img/default-store-image.jpg';
            storeItem.innerHTML = `
                <div class="card">
                    <img src="${imageUrl}" alt="${store.name}" class="store-image">
                    <div class="card-content">
                        <h3 class="store-name">${store.name}</h3>
                        <p class="store-address">${store.province} ${store.city}</p> <!-- 주소 결합 -->
                        <p class="store-phone">${store.phone}</p>
                    </div>
                </div>
            `;
            storeList.appendChild(storeItem);
        });
    }
    
    // 페이지 정보를 업데이트하는 함수
    function updatePageInfo() {
        const totalPages = Math.ceil(stores.length / itemsPerPage);
        document.getElementById('page-info').textContent = `${currentPage} / ${totalPages}`;
    }
    
    // 이전 페이지로 이동
    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            displayPage(currentPage);
            updatePageInfo();
        }
    }
    
    // 다음 페이지로 이동
    function nextPage() {
        const totalPages = Math.ceil(stores.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            displayPage(currentPage);
            updatePageInfo();
        }
    }
</script>   
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const map = L.map('map').setView([37.5665, 126.9780], 11); // 서울 중심으로 초기화

    // OpenStreetMap 타일 레이어 추가
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 매장 데이터를 불러와서 마커 추가
    let allStores = [];
    fetch('/api/stores')
        .then(response => response.json())
        .then(stores => {
            allStores = stores;  // 전체 매장 데이터를 저장
            stores.forEach(store => {
                if (store.lat && store.lng) {
                    const marker = L.marker([store.lat, store.lng]).addTo(map);
                    marker.bindPopup(`
                        <b>${store.name}</b><br>
                        ${store.province} ${store.city}<br>
                        ${store.phone || '전화번호 없음'}
                    `);
                }
            });
        })
        .catch(error => console.error('매장 위치를 불러오는 중 오류 발생:', error));

    // 검색 후 매장 위치로 지도 확대하는 함수
    window.searchStores = function() {
        const province = document.getElementById('province').value;
        const city = document.getElementById('city').value;

        if (!province || !city) {
            alert("지역과 시/군/구를 선택해 주세요.");
            return;
        }

        // 지역과 시/군/구에 맞는 매장만 필터링
        const filteredStores = allStores.filter(store =>
            store.province === province && store.city === city
        );

        if (filteredStores.length > 0) {
            // 지도 확대 및 첫 번째 매장 위치로 이동
            const store = filteredStores[0]; // 첫 번째 매장 선택
            map.setView([store.lat, store.lng], 14); // 지도 확대
            // 지도에서 해당 매장 마커 추가
            const marker = L.marker([store.lat, store.lng]).addTo(map);
            marker.bindPopup(`
                <b>${store.name}</b><br>
                ${store.province} ${store.city}<br>
                ${store.phone || '전화번호 없음'}
            `);

            // 필터링된 매장 목록 화면에 표시
            displayFilteredStores(filteredStores);
        } else {
            alert('검색된 매장이 없습니다.');
        }
    };

    // 필터링된 매장만 화면에 표시하는 함수
    function displayFilteredStores(filteredStores) {
        const storeList = document.getElementById('store-list');
        storeList.innerHTML = ''; // 기존 매장 목록 초기화

        filteredStores.forEach(store => {
            const storeItem = document.createElement('div');
            storeItem.classList.add('store-item');

            const imageUrl = store.image_url || 'img/default-store-image.jpg';
            storeItem.innerHTML = `
                <div class="card">
                    <img src="${imageUrl}" alt="${store.name}" class="store-image">
                    <div class="card-content">
                        <h3 class="store-name">${store.name}</h3>
                        <p class="store-address">${store.province} ${store.city}</p>
                        <p class="store-phone">${store.phone}</p>
                    </div>
                </div>
            `;
            storeList.appendChild(storeItem);
        });
    }
});
    </script>
    

</body>
</html>